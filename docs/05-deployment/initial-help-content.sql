-- Initial Help Content for MTK Care Help
-- Run this after the schema setup

-- Get category IDs for reference
DO $$
DECLARE
  getting_started_id UUID;
  features_id UUID;
  troubleshooting_id UUID;
  reference_id UUID;
  tips_id UUID;
BEGIN
  -- Get category IDs
  SELECT id INTO getting_started_id FROM categories WHERE name = 'Getting Started';
  SELECT id INTO features_id FROM categories WHERE name = 'Features';
  SELECT id INTO troubleshooting_id FROM categories WHERE name = 'Troubleshooting';
  SELECT id INTO reference_id FROM categories WHERE name = 'Reference';
  SELECT id INTO tips_id FROM categories WHERE name = 'Tips';

  -- Insert help articles
  INSERT INTO help_articles (id, title, description, content, category_id, tags, view_count) VALUES
  
  -- Getting Started Articles
  ('dashboard-overview', 
   'Dashboard Overview', 
   'Understanding your main dashboard and navigation',
   E'# Dashboard Overview\n\nThe dashboard provides a comprehensive view of your case management activities and key metrics. Use the navigation elements to quickly access different sections of the application.\n\n## Key Features\n\n### Real-time Metrics\n- Active cases count\n- Recent activity feed\n- Performance indicators\n- Urgent items requiring attention\n\n### Navigation Cards\n- **Cases**: Manage client cases and documentation\n- **Calendar**: View appointments and scheduled activities\n- **Reports**: Generate and view case reports\n- **Resources**: Access forms, templates, and reference materials\n\n## Getting Started\n\n1. **Review your active cases** in the main dashboard view\n2. **Check urgent items** highlighted in the priority section\n3. **Navigate using the sidebar** for detailed work\n4. **Use the search function** to quickly find specific cases or clients\n\n## Dashboard Sections\n\n### Overview Panel\nProvides a snapshot of your current workload including:\n- Cases requiring immediate attention\n- Upcoming appointments and deadlines\n- Recent case notes and updates\n- Team notifications and messages\n\n### Quick Actions\n- Create new case\n- Add case notes\n- Schedule appointment\n- Generate report\n\n## Tips for Efficiency\n\n- **Bookmark frequently used sections** for quick access\n- **Set up notifications** for important case updates\n- **Use keyboard shortcuts** for faster navigation\n- **Customize your dashboard view** based on your role and preferences\n\nFor more detailed information about specific features, explore the help topics in each section.',
   getting_started_id,
   ARRAY['dashboard', 'overview', 'navigation', 'getting-started'],
   245),

  ('user-settings',
   'User Settings and Profile',
   'Managing your account preferences and profile information',
   E'# User Settings\n\nAccess your user settings to update profile information, manage notifications, and configure application preferences. All changes are automatically saved.\n\n## Profile Settings\n\n### Personal Information\n- **Name and Contact Details**: Update your display name, email, and phone number\n- **Professional Information**: Job title, department, and supervisor details\n- **Profile Photo**: Upload and manage your profile picture\n\n### Account Preferences\n- **Language Settings**: Choose your preferred language for the interface\n- **Time Zone**: Set your local time zone for accurate scheduling\n- **Date Format**: Select your preferred date and time display format\n\n## Notification Settings\n\n### Email Notifications\n- Case assignment notifications\n- Appointment reminders\n- System updates and announcements\n- Weekly summary reports\n\n### In-App Notifications\n- Real-time case updates\n- Message notifications\n- Deadline reminders\n- System alerts\n\n## Privacy and Security\n\n### Password Management\n- Change your password regularly\n- Use strong, unique passwords\n- Enable two-factor authentication if available\n\n### Data Privacy\n- Review data sharing preferences\n- Manage client information access levels\n- Configure audit trail settings\n\n## Application Preferences\n\n### Interface Customization\n- **Theme**: Choose between light and dark modes\n- **Dashboard Layout**: Customize widget placement and visibility\n- **Sidebar Configuration**: Set default sidebar state and organization\n\n### Workflow Settings\n- **Default Case Templates**: Set your preferred case creation templates\n- **Auto-Save Intervals**: Configure how frequently your work is saved\n- **Calendar View**: Set default calendar view (day/week/month)\n\n## Accessibility Options\n\n- **Font Size**: Adjust text size for better readability\n- **High Contrast Mode**: Enable for improved visibility\n- **Screen Reader Support**: Configure for assistive technologies\n- **Keyboard Navigation**: Enable enhanced keyboard shortcuts\n\n## Getting Help\n\nIf you need assistance with settings or encounter any issues:\n- Use the help panel (? icon) for instant support\n- Contact your system administrator\n- Submit feedback through the settings page\n\nRemember that some settings may require administrator approval or may affect other users in your organization.',
   getting_started_id,
   ARRAY['settings', 'profile', 'account', 'preferences'],
   189),

  -- Reference Articles
  ('keyboard-shortcuts',
   'Keyboard Shortcuts',
   'Speed up your workflow with essential keyboard shortcuts',
   E'# Keyboard Shortcuts\n\nMaster these keyboard shortcuts to improve your productivity and navigate the application more efficiently.\n\n## Global Shortcuts\n\n### Navigation\n- **Ctrl + K**: Open command palette\n- **Ctrl + /**: Toggle help panel\n- **Ctrl + B**: Toggle sidebar\n- **Ctrl + H**: Go to home/dashboard\n- **Ctrl + S**: Save current work\n- **Esc**: Close modals and panels\n\n### Search and Find\n- **Ctrl + F**: Search within current page\n- **Ctrl + G**: Go to specific case (by ID or client name)\n- **Ctrl + Shift + F**: Global search across all cases\n\n## Case Management\n\n### Case Navigation\n- **Ctrl + N**: Create new case\n- **Ctrl + E**: Edit current case\n- **Ctrl + D**: Duplicate case\n- **Ctrl + Delete**: Archive case (with confirmation)\n\n### Case Notes\n- **Ctrl + M**: Add new case note\n- **Ctrl + Shift + M**: Add urgent case note\n- **Tab**: Navigate between form fields\n- **Shift + Tab**: Navigate backwards between fields\n\n## Calendar and Scheduling\n\n### Calendar Navigation\n- **Ctrl + Left/Right**: Navigate between days/weeks\n- **Ctrl + Up/Down**: Switch calendar views (day/week/month)\n- **Ctrl + T**: Go to today\n- **Ctrl + A**: Create new appointment\n\n## Text Editing\n\n### Rich Text Editor\n- **Ctrl + B**: Bold text\n- **Ctrl + I**: Italic text\n- **Ctrl + U**: Underline text\n- **Ctrl + Z**: Undo\n- **Ctrl + Y**: Redo\n- **Ctrl + L**: Create bulleted list\n- **Ctrl + Shift + L**: Create numbered list\n\n## Advanced Shortcuts\n\n### Batch Operations\n- **Ctrl + A**: Select all items\n- **Shift + Click**: Select range of items\n- **Ctrl + Click**: Select multiple individual items\n- **Delete**: Archive selected items\n\n### Quick Actions\n- **F2**: Rename selected item\n- **F5**: Refresh current page\n- **F11**: Toggle fullscreen mode\n- **Alt + F4**: Close current window/modal\n\n## Tips for Learning Shortcuts\n\n1. **Start with basics**: Master the global navigation shortcuts first\n2. **Practice regularly**: Use shortcuts instead of mouse clicks when possible\n3. **Enable tooltips**: Hover over buttons to see their shortcuts\n4. **Customize shortcuts**: Contact your administrator about customization options\n\n## Mobile and Tablet\n\nOn touch devices, some shortcuts work differently:\n- **Long press**: Equivalent to right-click\n- **Swipe gestures**: Navigate between sections\n- **Pinch to zoom**: Adjust text size\n\n## Accessibility\n\nFor users with accessibility needs:\n- All shortcuts work with screen readers\n- Tab navigation follows logical flow\n- Focus indicators are clearly visible\n- Alternative navigation methods available\n\nMost shortcuts follow standard conventions, so if you''re familiar with other applications, many will feel natural.',
   reference_id,
   ARRAY['shortcuts', 'keyboard', 'productivity', 'navigation'],
   156),

  ('data-export',
   'Data Export and Reporting',
   'How to export case data and generate reports',
   E'# Data Export and Reporting\n\nExport your case data and generate comprehensive reports for analysis, compliance, and sharing with stakeholders.\n\n## Export Options\n\n### Available Formats\n- **CSV**: For spreadsheet applications like Excel\n- **PDF**: For formal reports and documentation\n- **JSON**: For developers and system integrations\n- **XML**: For regulatory compliance and data exchange\n\n### Export Types\n- **Case Summary Reports**: Overview of case status and outcomes\n- **Client Data**: Demographic and contact information\n- **Service Records**: Detailed service delivery logs\n- **Appointment History**: Scheduling and attendance records\n\n## Generating Reports\n\n### Quick Reports\n1. Navigate to **Reports** section\n2. Select **Quick Report** template\n3. Choose date range and filters\n4. Click **Generate Report**\n5. Download when processing completes\n\n### Custom Reports\n1. Go to **Reports > Custom Report Builder**\n2. Select data fields to include\n3. Apply filters and sorting options\n4. Preview report layout\n5. Save template for future use\n6. Generate and download report\n\n## Data Privacy and Compliance\n\n### Privacy Protection\n- **De-identification**: Personal identifiers can be removed\n- **Consent Verification**: System checks client consent status\n- **Access Logging**: All exports are logged for audit purposes\n- **Secure Download**: Reports expire after 24 hours\n\n### Compliance Features\n- **GDPR Compliance**: Right to data portability supported\n- **HIPAA Requirements**: Encrypted export options available\n- **Audit Trails**: Complete record of who exported what data\n- **Retention Policies**: Automatic cleanup of expired reports\n\n## Export Limitations\n\n### File Size Limits\n- **CSV exports**: Maximum 10,000 records per file\n- **PDF reports**: Maximum 500 pages\n- **Bulk exports**: May be split into multiple files\n\n### Processing Time\n- Small reports (< 100 records): Instant\n- Medium reports (100-1000 records): 1-2 minutes\n- Large reports (1000+ records): 5-10 minutes\n- Premium users get priority processing\n\n## Advanced Features\n\n### Scheduled Reports\n- **Daily summaries**: Automatically generated overnight\n- **Weekly reports**: Sent every Monday morning\n- **Monthly analytics**: Comprehensive monthly breakdowns\n- **Custom schedules**: Set up your own reporting schedule\n\n### API Access\n- **REST API endpoints**: For programmatic data access\n- **Rate limiting**: 1000 requests per hour for standard users\n- **Authentication**: API keys required for all requests\n- **Documentation**: Full API documentation available\n\n## Troubleshooting\n\n### Common Issues\n- **Export taking too long**: Try reducing date range or adding filters\n- **File won''t download**: Check browser popup blocker settings\n- **Data missing**: Verify you have appropriate permissions\n- **Format issues**: Ensure you''re using compatible software to open exports\n\n### Getting Support\n- **Help Desk**: Contact for technical export issues\n- **Training**: Available for complex reporting needs\n- **Documentation**: Detailed guides for each export type\n\n## Best Practices\n\n1. **Regular Backups**: Export data regularly for backup purposes\n2. **Test Reports**: Preview reports before generating large exports\n3. **Secure Storage**: Store exported files securely and delete when no longer needed\n4. **Documentation**: Keep records of what data was exported and when\n5. **Training**: Ensure staff understand privacy requirements for exported data\n\nRemember that exported data contains sensitive client information and must be handled according to your organization''s privacy and security policies.',
   reference_id,
   ARRAY['export', 'data', 'reports', 'csv', 'pdf', 'compliance'],
   98),

  -- Tips Articles  
  ('performance-tips',
   'Performance Optimization Tips',
   'Best practices to optimize your workflow and system performance',
   E'# Performance Tips\n\nOptimize your experience and work more efficiently with these performance tips and best practices.\n\n## System Performance\n\n### Browser Optimization\n- **Use supported browsers**: Chrome, Firefox, Safari, or Edge (latest versions)\n- **Clear cache regularly**: Monthly clearing improves performance\n- **Disable unnecessary extensions**: Browser extensions can slow down the application\n- **Close unused tabs**: Keep only essential tabs open while working\n\n### Network Performance\n- **Stable internet connection**: Use wired connection when possible\n- **VPN considerations**: Some VPNs may slow down performance\n- **Peak hours**: System may be slower during 9-11 AM and 2-4 PM\n- **Regional servers**: Data is served from Sydney for optimal NZ performance\n\n## Workflow Efficiency\n\n### Navigation Tips\n- **Use keyboard shortcuts**: Much faster than mouse navigation\n- **Bookmark frequently used pages**: Create browser bookmarks for common tasks\n- **Customize your dashboard**: Arrange widgets based on your workflow\n- **Learn the command palette**: Ctrl+K for instant access to any feature\n\n### Data Entry Optimization\n- **Use templates**: Pre-populated forms save significant time\n- **Auto-save feature**: Content saves every 30 seconds automatically\n- **Bulk operations**: Select multiple items for batch processing\n- **Copy previous entries**: Duplicate similar cases or appointments\n\n## Search and Filtering\n\n### Effective Searching\n- **Use specific terms**: \"John Smith diabetes\" vs just \"John\"\n- **Filter by date ranges**: Narrow results to relevant time periods\n- **Save common searches**: Create saved search filters for regular queries\n- **Use advanced search**: Combine multiple criteria for precise results\n\n### Case Management\n- **Organize with tags**: Use consistent tagging for easy categorization\n- **Status updates**: Keep case statuses current for accurate reporting\n- **Archive old cases**: Remove completed cases from active views\n- **Use priority flags**: Mark urgent cases for quick identification\n\n## Mobile Performance\n\n### Mobile Optimization\n- **Use the mobile app**: Better performance than mobile browser\n- **WiFi when possible**: Avoid using mobile data for large operations\n- **Sync settings**: Enable offline sync for critical data\n- **Battery optimization**: Close app when not in use to preserve battery\n\n### Responsive Features\n- **Touch gestures**: Swipe to navigate between screens\n- **Voice input**: Use voice-to-text for faster note entry\n- **Offline mode**: Continue working without internet connection\n- **Push notifications**: Stay updated without keeping app open\n\n## Data Management\n\n### File Handling\n- **Optimize images**: Compress photos before uploading\n- **Organize documents**: Use consistent naming and folder structure\n- **Regular cleanup**: Archive or delete unnecessary files\n- **Cloud storage**: Leverage cloud backup for large files\n\n### Database Performance\n- **Limit large reports**: Generate reports in smaller date ranges\n- **Use filters effectively**: Reduce dataset size before exporting\n- **Schedule large operations**: Run big exports during off-peak hours\n- **Monitor storage usage**: Keep within allocated storage limits\n\n## Troubleshooting Common Issues\n\n### Slow Loading Pages\n1. **Check internet connection**: Run speed test\n2. **Clear browser cache**: Force refresh with Ctrl+F5\n3. **Disable extensions**: Try incognito/private mode\n4. **Contact support**: If issues persist\n\n### Application Freezing\n1. **Close other applications**: Free up system memory\n2. **Refresh the page**: Use browser refresh\n3. **Restart browser**: Complete browser restart\n4. **Check system resources**: Ensure adequate RAM available\n\n## Advanced Tips\n\n### Power User Features\n- **API integration**: Connect with other tools using our API\n- **Custom reporting**: Build automated report workflows\n- **Bulk import**: Use CSV imports for large datasets\n- **Integration tools**: Connect with calendar and email systems\n\n### Monitoring Usage\n- **Track your patterns**: Use analytics to understand your workflow\n- **Optimize peak times**: Schedule heavy tasks during low-usage periods\n- **Team coordination**: Coordinate with colleagues for shared resources\n- **Regular reviews**: Monthly review of system usage and optimization\n\n## Getting Help\n\nIf performance issues persist:\n- **Use the help panel**: Instant access to troubleshooting guides\n- **Contact IT support**: For persistent technical issues\n- **Training resources**: Additional training for complex workflows\n- **Community forums**: Connect with other users for tips and solutions\n\nRemember that small optimizations compound over time - implementing even a few of these tips can significantly improve your daily efficiency.',
   tips_id,
   ARRAY['performance', 'optimization', 'tips', 'efficiency', 'workflow'],
   134),

  -- API Reference
  ('api-integration',
   'API Integration Guide',
   'Technical guide for integrating with external systems',
   E'# API Integration Guide\n\nConnect external systems and automate workflows using our comprehensive REST API.\n\n## Getting Started\n\n### Authentication\n1. **Generate API Keys**: Go to Settings > API Access\n2. **Choose Permissions**: Select appropriate access levels\n3. **Secure Storage**: Store keys securely, never in code repositories\n4. **Key Rotation**: Rotate keys every 90 days for security\n\n### Base URLs\n- **Production**: `https://api.mtkcare.com/v1`\n- **Staging**: `https://staging-api.mtkcare.com/v1`\n- **Rate Limits**: 1000 requests per hour (standard users)\n\n## Authentication Methods\n\n### API Key Authentication\n```http\nGET /api/v1/cases\nAuthorization: Bearer YOUR_API_KEY\nContent-Type: application/json\n```\n\n### OAuth 2.0 (Enterprise)\n```http\nPOST /oauth/token\nContent-Type: application/x-www-form-urlencoded\n\ngrant_type=client_credentials&\nclient_id=YOUR_CLIENT_ID&\nclient_secret=YOUR_CLIENT_SECRET\n```\n\n## Core Endpoints\n\n### Cases API\n\n#### List Cases\n```http\nGET /api/v1/cases\nQuery Parameters:\n- status: active|closed|pending\n- assigned_to: user_id\n- created_after: ISO 8601 date\n- limit: 1-100 (default: 20)\n- offset: pagination offset\n```\n\n#### Create Case\n```http\nPOST /api/v1/cases\nContent-Type: application/json\n\n{\n  \"client_id\": \"12345\",\n  \"title\": \"New case title\",\n  \"description\": \"Case description\",\n  \"priority\": \"high|medium|low\",\n  \"assigned_to\": \"user_id\",\n  \"due_date\": \"2024-12-31T23:59:59Z\"\n}\n```\n\n#### Update Case\n```http\nPUT /api/v1/cases/{case_id}\nContent-Type: application/json\n\n{\n  \"status\": \"closed\",\n  \"resolution_notes\": \"Case completed successfully\"\n}\n```\n\n### Clients API\n\n#### Search Clients\n```http\nGET /api/v1/clients?q=search_term&limit=10\n```\n\n#### Client Details\n```http\nGET /api/v1/clients/{client_id}\n```\n\n### Appointments API\n\n#### List Appointments\n```http\nGET /api/v1/appointments\nQuery Parameters:\n- start_date: ISO 8601 date\n- end_date: ISO 8601 date\n- staff_id: filter by staff member\n- status: scheduled|completed|cancelled\n```\n\n#### Create Appointment\n```http\nPOST /api/v1/appointments\nContent-Type: application/json\n\n{\n  \"client_id\": \"12345\",\n  \"staff_id\": \"67890\",\n  \"start_time\": \"2024-01-15T10:00:00Z\",\n  \"duration_minutes\": 60,\n  \"type\": \"consultation\",\n  \"notes\": \"Initial assessment\"\n}\n```\n\n## Webhooks\n\n### Setting Up Webhooks\n1. **Configure endpoint URL**: Must be HTTPS\n2. **Select events**: Choose which events to receive\n3. **Verify signatures**: Use provided secret for verification\n4. **Handle retries**: Implement retry logic for failed deliveries\n\n### Available Events\n- `case.created`\n- `case.updated`\n- `case.closed`\n- `appointment.scheduled`\n- `appointment.cancelled`\n- `client.updated`\n\n### Webhook Payload Example\n```json\n{\n  \"event\": \"case.created\",\n  \"timestamp\": \"2024-01-15T10:30:00Z\",\n  \"data\": {\n    \"case_id\": \"12345\",\n    \"client_id\": \"67890\",\n    \"title\": \"New case\",\n    \"created_by\": \"user_123\"\n  }\n}\n```\n\n## Error Handling\n\n### HTTP Status Codes\n- `200`: Success\n- `201`: Created successfully\n- `400`: Bad request (validation error)\n- `401`: Unauthorized (invalid API key)\n- `403`: Forbidden (insufficient permissions)\n- `404`: Resource not found\n- `429`: Rate limit exceeded\n- `500`: Internal server error\n\n### Error Response Format\n```json\n{\n  \"error\": {\n    \"code\": \"VALIDATION_ERROR\",\n    \"message\": \"Invalid input data\",\n    \"details\": {\n      \"field\": \"email\",\n      \"issue\": \"Invalid email format\"\n    }\n  }\n}\n```\n\n## Rate Limiting\n\n### Limits by Plan\n- **Free**: 100 requests/hour\n- **Pro**: 1,000 requests/hour  \n- **Enterprise**: Custom limits\n\n### Rate Limit Headers\n```http\nX-RateLimit-Limit: 1000\nX-RateLimit-Remaining: 999\nX-RateLimit-Reset: 1609459200\n```\n\n### Handling Rate Limits\n```javascript\nif (response.status === 429) {\n  const resetTime = response.headers[''X-RateLimit-Reset''];\n  const waitTime = resetTime - Date.now() / 1000;\n  // Wait and retry\n  setTimeout(() => retryRequest(), waitTime * 1000);\n}\n```\n\n## Best Practices\n\n### Performance\n- **Use pagination**: Don''t fetch all records at once\n- **Cache responses**: Cache data that doesn''t change frequently\n- **Batch requests**: Combine multiple operations when possible\n- **Use ETags**: Implement conditional requests for efficiency\n\n### Security\n- **HTTPS only**: Never use HTTP for API calls\n- **Validate inputs**: Always validate data before sending\n- **Log API usage**: Monitor for unusual patterns\n- **Rotate keys regularly**: Change API keys every 90 days\n\n### Reliability\n- **Implement retries**: Use exponential backoff for retries\n- **Handle timeouts**: Set appropriate timeout values\n- **Monitor status**: Check API status page for outages\n- **Graceful degradation**: Handle API downtime gracefully\n\n## SDKs and Tools\n\n### Official SDKs\n- **JavaScript/Node.js**: `npm install @mtkcare/api-client`\n- **Python**: `pip install mtkcare-api`\n- **PHP**: Available via Composer\n- **C#/.NET**: NuGet package available\n\n### Testing Tools\n- **Postman Collection**: Import our complete API collection\n- **OpenAPI Spec**: Full specification available for code generation\n- **Sandbox Environment**: Test API calls without affecting production data\n\n## Support\n\n- **API Documentation**: Complete reference at api-docs.mtkcare.com\n- **Developer Support**: developer-support@mtkcare.com\n- **Status Page**: status.mtkcare.com for API uptime\n- **Community**: Join our developer Slack channel\n\nFor more advanced integration patterns and examples, visit our developer portal.',
   reference_id,
   ARRAY['api', 'integration', 'development', 'webhooks', 'authentication'],
   67);

  -- Add some analytics data for demonstration
  INSERT INTO help_analytics (article_id, action, context, session_hash) VALUES
    ('dashboard-overview', 'view', NULL, 'anon_session_1'),
    ('user-settings', 'view', NULL, 'anon_session_1'),
    ('keyboard-shortcuts', 'view', NULL, 'anon_session_2'),
    (NULL, 'search', 'dashboard help', 'anon_session_3'),
    (NULL, 'search', 'how to export data', 'anon_session_4'),
    ('performance-tips', 'view', NULL, 'anon_session_5');

END $$;